<!DOCTYPE html>
<html>
<head>
    <title>凡科互动</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta content="application/xhtml+xml;charset=UTF-8" http-equiv="Content-Type">
    <meta content="no-cache,must-revalidate" http-equiv="Cache-Control">
    <meta content="no-cache" http-equiv="pragma">
    <meta content="0" http-equiv="expires">
    <meta content="telephone=no, address=no" name="format-detection">
    <meta name="viewport" content="user-scalable=0">
    <meta name="apple-mobile-web-app-capable" content="yes"> <!-- apple devices fullscreen -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta id="_TOKEN" value="632e043c6d8d2e5093eee6ef190eb82d" type="hidden">

    <link href="css/index.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="css/detailss.css"/>
    <script type="text/javascript" src="js/jquery-2.1.0.js"></script>
    <script src="js/config.js" type="text/javascript"></script>
    <script src="js/vue.min.js" type="text/javascript"></script>

    <script>
        $(function(){
            var remBase = Math.min(window.innerWidth,window.innerHeight)/16;
            remBase === 0 && (remBase = 20);
            document.getElementsByTagName('html')[0].style.fontSize = remBase + 'px';
            g_rem = parseFloat(remBase);
        });
    </script>
</head>
<body>
<div class="jiazaik" style="width: 100%;height: 100%;position: absolute;top:0;left:0;background: rgba(0,0,0,0.2);z-index:999;display: none;">
    <div id="loading" class="loading">保存中...</div>
</div>
<div class="huodong">
    <div class="dinbutup" onclick="document.getElementById('uploadss').click()" style="background: url(image/AAEIABACGAAg-qyM0gUo_eqN7QIwwgM4_gE.jpg)no-repeat;background-size:170%;background-position-x:50% ;">
        <img style="width:4rem;height:4rem;margin-top: 4rem;" src="image/jiasi.png"/>
        <p style="color: #fff;">（请上传一张活动图）</p>
        <input id="uploadss" name="file" style="display: none;" onchange="readAsDataURLss()" type="file"/>
    </div>
    <div class="huodongshijs">
        <div class="kaishishij">
            <span>活动详情标题：</span>
            <input type="" value="" class="shijians huodongtitle" />
        </div>
    </div>
    <div class="huodongshij">
        <div class="kaishishij">
            <span>活动开始时间：</span>
            <input type="date" value="" class="shijian kaishishijian" />
        </div>
        <div class="kaishishij">
            <span>活动结束时间：</span>
            <input type="date" value=""  class="shijian end_time"/>
        </div>
    </div>
    <div class="beijing">
        <div class="cibanben">
            <div class="kanjiaxqbiaot">商品砍价设置</div>
            <div class="yjsz_dijia">
                <div class="kanjia_yuanj">
                    <span>商品原价：</span>
                    <input type="number" class="kanjia_input original_price" value="" />
                    <span>元</span>
                </div>
                <div class="kanjia_yuanj">
                    <span>商品低价：</span>
                    <input type="number" class="kanjia_input cut_price" value="" />
                    <span>元</span>
                </div>
            </div>
            <div class="kanjiaxqbiaots">基础设置：</div>
            <div class="yjsz_dijia">
                <div class="kanjia_yuanj">
                    <span>商品数量：</span>
                    <input type="number" class="kanjia_input com_num" value="" />
                    <span>个</span>
                </div>
                <div class="kanjia_yuanj">
                    <span>砍价次数：</span>
                    <input type="number" class="kanjia_input cut_num" value="" />
                    <span>次</span>
                </div>
            </div>
            <div class="kanjiaxqbiaotss">每个报名者在活动时间内只可减价一次</div>

        </div>
    </div>
    <div class="mioashu">
        <div class="shipms">
            <div class="shangpmiaoshu">商品描述</div>
        </div>
        <div class="miaoshusp">

            <div class="textareams">
                <textarea class="textareamsss shoud_know" placeholder="请输入兑奖须知"></textarea>
            </div>
            <div class="sptupshagncsss">
                <img src="" id="pic" style="width:100%;"/>
            </div>

            <div class="sptupshagnc" onclick="document.getElementById('upload').click()" >
                <input id="upload" name="file" style="display: none;" onchange="readAsDataURL()" type="file"/>
                <img style="width:4rem;height:4rem;margin-top: 1rem;" src="image/tushanshagnc.png"/>
                <p style="color: #244C35;">（请上传一张商品图）</p>
            </div>
            <div class="sptupsha">
                <div class="kaishishijs">
                    <span>商品名称：</span>
                    <input  value="" class="shijians com_name" />
                </div>
            </div>
        </div>
    </div>
    <div class="mioashu">
        <div class="shipms">
            <div class="shangpmiaoshu">活动详情</div>
        </div>
        <div class="miaoshusp">
            <div class="textareams">
                <textarea class="textareamsss explain" placeholder="请输入活动说明内容"></textarea>
            </div>
            <div class="sptupshagncs">
                <div class="kaishishijs">
                    <span>领奖地址：</span>
                    <input  value="" class="shijians do_address" />
                </div>
                <div class="kaishishijs">
                    <span>领奖电话：</span>
                    <input type="number"  value="" class="shijians service_phone" />
                </div>
            </div>
        </div>
    </div>
    <div class="mioashu">
        <div class="shipms">
            <div class="shangpmiaoshu">活动音乐</div>
        </div>
        <div class="miaoshusps">
            <div class="sptup" id="actListBox" style="width:90%;margin: auto;">
                <div style="width:100%;height:1.5rem;" v-for="v in recoms">
                    <label>{{v.bgm_name}}</label>
                    <input type="radio" name="radio"  v-bind:value="v.id" style="height:70px;width:70px;float: right; "/>
                </div>
            </div>

        </div>
    </div>
    <div id="bottomTips" class="editBottomTips" style="color: #F0EFF5;">
        手机版仅支持体验部分功能<br>更多功能请登录电脑版
    </div>
</div>
<input type="hidden" class="shangptu">
<input type="hidden" class="huodongtu">
<div class="bottomFixedMenu" style="position: fixed;left:0; bottom: 0px;">
    <div class="corp_btn_line">
        <span id="saveButon" class="bg_blue" style="background: #188AE2;">保存活动</span>
    </div>
</div>

<script type="text/javascript">
    $(function () {
        $.ajax({
            url:httpurl+"Add/bgm",
            type:"post",
            data:{},
            success:function(e){
                var items = e;
                reitems.recoms = reitems.recoms.concat(convert(items));
            },
        });
    })
    var reitems = new Vue({
        el: '#actListBox',
        data: {
            recoms: [] //列表信息流数据
        }
    });

    function convert(items) {
        var newItems = [];
        items.forEach(function(item) {
            newItems.push({
                id: item.id,
                bgm_name: item.bgm_name
            });
        });
        return newItems;
    }
    $('#saveButon').click(function(){

        //活动信息
        var title = $('.huodongtitle').val();
        var start_time = $('.kaishishijian').val();//活动开始时间
        var end_time = $('.end_time').val();//活动结束时间
        var do_address = $('.do_address').val();//领奖地址
        var service_phone = $('.service_phone').val();//领奖电话
        var explain = $('.explain').val();//活动说明
        var ac_thumb = $('.huodongtu').val();//活动图片
        var bgm_id="";//活动音乐
        var radio=document.getElementsByName("radio");
        for(var i=0;i<radio.length;i++){
            if(radio[i].checked==true){
                bgm_id=radio[i].value;
            }
        }
        //商品信息
        var original_price = $('.original_price').val();//商品原价
        var cut_price = $('.cut_price').val();//砍价目标
        var com_num = $('.com_num').val();//商品数量
        var cut_num = $('.cut_num').val();//需砍次数
        var shoud_know = $('.shoud_know').val();//兑奖须知
        var thumb = $('.shangptu').val();//商品图
        var com_name = $('.com_name').val();//活动说明
        var user_id = localStorage.getItem('user_id');
        if(title == ''){
            alert('请填写活动标题！');
            return false;
        }
        if(start_time == ''){
            alert('请填写活动开始时间！');
            return false;
        }
        if(end_time == ''){
            alert('请填写活动结束时间！');
            return false;
        }
        if(do_address == ''){
            alert('请填写领奖地址！');
            return false;
        }
        if(service_phone == ''){
            alert('请填写领奖电话！');
            return false;
        }
        if(explain == ''){
            alert('请填写商品名称！');
            return false;
        }
        if(ac_thumb == ''){
            alert('请选择活动图片！');
            return false;
        }
        if(bgm_id == ''){
            alert('请选择活动音乐！');
            return false;
        }
        if(original_price == ''){
            alert('请填写商品原价！');
            return false;
        }

        if(cut_price == ''){
            alert('请填写砍价目标！');
            return false;
        }
        if(com_num == ''){
            alert('请填写商品数量！');
            return false;
        }
        if(cut_num == ''){
            alert('请填写需砍次数！');
            return false;
        }
        if(shoud_know == ''){
            alert('请填写兑奖须知！');
            return false;
        }
        if(thumb == ''){
            alert('请选择商品图！');
            return false;
        }
        if(com_name == ''){
            alert('请填写活动说明！');
            return false;
        }
        $('.jiazaik').attr('style','display: block;');
        $.ajax({
            url:httpurl+"Add/modil_create_activity",
            type:"post",
            data:{
                title:title,
                start_time:start_time,
                end_time:end_time,
                do_address:do_address,
                service_phone:service_phone,
                explain:explain,
                ac_thumb:ac_thumb,
                bgm_id:bgm_id,
                original_price:original_price,
                cut_price:cut_price,
                com_num:com_num,
                cut_num:cut_num,
                shoud_know:shoud_know,
                thumb:thumb,
                com_name:com_name,
                create_id:user_id,
            },
            success:function(e){
                if(e==0){
                    alert('活动创建失败！');
                }else{
                    alert('活动创建成功！');
                    window.location.href='activity.html';
                }
            },
        });
    })

    function readAsDataURL(){
        var file = document.getElementById("upload").files;
        var objUrl = getObjectURL(file[0]) ; //获取图片的路径，该路径不是图片在本地的路径
        if (objUrl) {
            $("#pic").attr("src", objUrl) ; //将图片路径存入src中，显示出图片
            var formdata =new FormData();
            formdata.append("file", document.getElementById("upload").files[0]);
            $.ajax({
                url:httpurl+"Add/up_imgs",
                type:"POST",
                data:formdata,
                contentType: false,        /*不可缺*/
                processData: false,
                success:function(e){
                    var obj = JSON.parse(e);
                    console.log(obj.src);
                    $('.shangptu').val(obj.src);
                },
            });
        }
    }
    function readAsDataURLss(){
        var file = document.getElementById("uploadss").files;
        var objUrl = getObjectURL(file[0]) ; //获取图片的路径，该路径不是图片在本地的路径
        if (objUrl) {
            $(".dinbutup").attr("style",'background:url('+objUrl+')no-repeat;background-size:170%;background-position-x:50% ;') ;
            var formdata =new FormData();
            formdata.append("file", document.getElementById("uploadss").files[0]);
            $.ajax({
                url:httpurl+"Add/up_imgs",
                type:"POST",
                data:formdata,
                contentType: false,        /*不可缺*/
                processData: false,
                success:function(e){
                    var obj = JSON.parse(e);
                    console.log(obj.src);
                    $('.huodongtu').val(obj.src);
                },
            });
        }
    }
    function getObjectURL(file) {
        var url = null ;
        if (window.createObjectURL!=undefined) { // basic
            url = window.createObjectURL(file) ;
        } else if (window.URL!=undefined) { // mozilla(firefox)
            url = window.URL.createObjectURL(file) ;
        } else if (window.webkitURL!=undefined) { // webkit or chrome
            url = window.webkitURL.createObjectURL(file) ;
        }
        return url ;
    }
</script>

</body>
</html>
